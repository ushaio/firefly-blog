import{z as e,Y as s,a0 as t,Z as n,B as o,P as c,y as i,K as f,ac as r,Q as a}from"./render.BDQaTL4F.js";class h{anchor;#e=new Map;#s=new Map;#t=new Map;#n=new Set;#o=!0;constructor(e,s=!0){this.anchor=e,this.#o=s}#c=()=>{var c=e;if(this.#e.has(c)){var i=this.#e.get(c),f=this.#s.get(i);if(f)s(f),this.#n.delete(i);else{var a=this.#t.get(i);a&&(this.#s.set(i,a.effect),this.#t.delete(i),a.fragment.lastChild.remove(),this.anchor.before(a.fragment),f=a.effect)}for(const[e,s]of this.#e){if(this.#e.delete(e),e===c)break;const n=this.#t.get(s);n&&(t(n.effect),this.#t.delete(s))}for(const[e,s]of this.#s){if(e===i||this.#n.has(e))continue;const c=()=>{if(Array.from(this.#e.values()).includes(e)){var n=document.createDocumentFragment();r(s,n),n.append(o()),this.#t.set(e,{effect:s,fragment:n})}else t(s);this.#n.delete(e),this.#s.delete(e)};this.#o||!f?(this.#n.add(e),n(s,c,!1)):c()}}};#i=e=>{this.#e.delete(e);const s=Array.from(this.#e.values());for(const[n,o]of this.#t)s.includes(n)||(t(o.effect),this.#t.delete(n))};ensure(s,t){var n=e,r=a();if(t&&!this.#s.has(s)&&!this.#t.has(s))if(r){var h=document.createDocumentFragment(),d=o();h.append(d),this.#t.set(s,{effect:c(()=>t(d)),fragment:h})}else this.#s.set(s,c(()=>t(this.anchor)));if(this.#e.set(n,s),r){for(const[e,t]of this.#s)e===s?n.skipped_effects.delete(t):n.skipped_effects.add(t);for(const[e,t]of this.#t)e===s?n.skipped_effects.delete(t.effect):n.skipped_effects.add(t.effect);n.oncommit(this.#c),n.ondiscard(this.#i)}else i&&(this.anchor=f),this.#c()}}export{h as B};
