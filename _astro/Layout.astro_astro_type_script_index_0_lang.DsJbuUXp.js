import{_ as e}from"./preload-helper.BhLMWRjL.js";import{p as t,u as n}from"./url-utils.BgRX8D30.js";import{m as o,n as i,o as s,B as a,p as d,q as c}from"./setting-utils.C6dLkNFg.js";import{s as r}from"./zh_TW.DUjyqjc_.js";function l(){function e(e){if(e.hasAttribute("data-icon-initialized"))return;e.setAttribute("data-icon-initialized","true");const t=e.querySelector("[data-loading-indicator]"),n=e.querySelector("[data-icon-element]"),o=n?.getAttribute("icon");if(t&&n){if(t.style.display="inline-flex",n.classList.remove("opacity-100"),n.classList.add("opacity-0"),n.addEventListener("load",()=>{s()}),n.addEventListener("error",()=>{o&&console.warn(`Failed to load icon: ${o}`)}),window.MutationObserver){const e=new MutationObserver(()=>{i()&&e.disconnect()});e.observe(n,{childList:!0,subtree:!0,attributes:!0}),setTimeout(()=>{e.disconnect(),i()},5e3)}setTimeout(()=>{i()},100)}function i(){return!!(n.shadowRoot&&n.shadowRoot.children.length>0)&&(s(),!0)}function s(){t.style.display="none",n.classList.remove("opacity-0"),n.classList.add("opacity-100")}}if(document.querySelectorAll("[data-icon-container]").forEach(e),window.MutationObserver){new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const n=t;n.hasAttribute?.("data-icon-container")?e(n):n.querySelectorAll("[data-icon-container]").forEach(e)}})})}).observe(document.body,{childList:!0,subtree:!0})}}const m=Object.freeze(Object.defineProperty({__proto__:null,initIconLoader:l},Symbol.toStringTag,{value:"Module"})),u=!!document.getElementById("wallpaper-wrapper");function p(e,t){document.addEventListener("click",n=>{let o=document.getElementById(e);if(!o)return;let i=n.target;if(i instanceof Node){for(let e of t){let t=document.getElementById(e);if(t==i||t?.contains(i))return}o.classList.add("float-panel-closed")}})}function h(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(e=>{if(!e.parentNode)return;const t=document.createElement("div");t.className="katex-display-container",e.parentNode.insertBefore(t,e),t.appendChild(e),t.style.cssText="\n\t\t\toverflow-x: auto;\n\t\t",e.setAttribute("data-scrollbar-initialized","true")})}function w(){requestAnimationFrame(()=>{const e=document.getElementById("banner");e&&e.classList.remove("opacity-0","scale-105");const t=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');t&&(t.classList.remove("opacity-0","scale-105"),t.classList.add("opacity-100"))})}p("display-setting",["display-setting","display-settings-switch"]),p("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]),p("search-panel",["search-panel","search-bar","search-switch"]),p("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]),p("theme-mode-panel",["theme-mode-panel","scheme-switch"]);const y=()=>{window.swup.hooks.on("link:click",()=>{if(document.documentElement.style.setProperty("--content-delay","0ms"),document.documentElement.classList.add("is-page-transitioning"),u){const e=document.getElementById("navbar-wrapper");if(e&&document.body.classList.contains("lg:is-home")){const t=window.innerHeight*(d/100)-88;document.documentElement.scrollTop>=t&&e.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{S(),h(),e(async()=>{const{initIconLoader:e}=await Promise.resolve().then(()=>m);return{initIconLoader:e}},void 0).then(({initIconLoader:e})=>{e()});if(null!==document.getElementById("toc-wrapper")){const e=document.querySelector("table-of-contents");e&&"function"==typeof e.init&&setTimeout(()=>{e.init()},100)}const t=document.getElementById("navbar");if(t){"semifull"===t.getAttribute("data-transparent-mode")&&"function"==typeof window.initSemifullScrollDetection&&window.initSemifullScrollDetection()}}),window.swup.hooks.on("visit:start",e=>{const o=document.querySelector("body"),i=t(e.to.url,n("/"));i?o.classList.add("lg:is-home"):o.classList.remove("lg:is-home");const s=document.querySelector(".banner-text-overlay");s&&(i?s.classList.remove("hidden"):s.classList.add("hidden"));const a=document.getElementById("navbar");if(a){a.setAttribute("data-is-home",i.toString());"semifull"===a.getAttribute("data-transparent-mode")&&"function"==typeof window.initSemifullScrollDetection&&window.initSemifullScrollDetection()}const d=window.innerWidth<1024;if(d){const e=document.getElementById("post-list-container");e&&(e.style.transition="none")}const c=document.getElementById("wallpaper-wrapper"),r=document.querySelector(".absolute.w-full.z-30");d&&c&&r?i?(r.style.transition="none",c.style.display="",setTimeout(()=>{c.classList.remove("mobile-hide-banner")},100),setTimeout(()=>{r.classList.remove("mobile-main-no-banner"),setTimeout(()=>{r.style.transition=""},50)},150)):(c.classList.add("mobile-hide-banner"),setTimeout(()=>{r.classList.add("mobile-main-no-banner")},100)):!d&&c&&(c.style.display="",c.classList.remove("mobile-hide-banner"),r&&r.classList.remove("mobile-main-no-banner"));const l=document.getElementById("page-height-extend");l&&l.classList.remove("hidden");let m=document.getElementById("toc-wrapper");m&&m.classList.add("toc-not-ready")}),window.swup.hooks.on("page:view",()=>{I(),S();const e=document.getElementById("page-height-extend");e&&e.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"});window.innerWidth<1024&&setTimeout(()=>{const e=document.getElementById("post-list-container");e&&(e.style.transition="")},600);const t=localStorage.getItem("theme")||r.themeColor.defaultMode;let n=!1;n="system"===t?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===t;const o=n?s.darkTheme:s.lightTheme;document.documentElement.getAttribute("data-theme")!==o&&document.documentElement.setAttribute("data-theme",o),setTimeout(()=>{if(document.getElementById("tcomment")){const e=new CustomEvent("firefly:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(e),console.log("Layout: 触发 firefly:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",e=>{setTimeout(()=>{const e=document.getElementById("page-height-extend");e&&e.classList.add("hidden");const t=document.getElementById("toc-wrapper");t&&t.classList.remove("toc-not-ready"),document.documentElement.classList.remove("is-page-transitioning")},200)})};window?.swup?.hooks?y():document.addEventListener("swup:enable",y);let g,f=document.getElementById("back-to-top-btn"),b=document.getElementById("toc-wrapper"),L=document.getElementById("navbar-wrapper");function E(){const e=document.documentElement.scrollTop,t=window.innerHeight*(d/100),n=[];f&&n.push(()=>{e>t?f.classList.remove("hide"):f.classList.add("hide")}),u&&b&&n.push(()=>{e>t?b.classList.remove("toc-hide"):b.classList.add("toc-hide")}),u&&L&&n.push(()=>{const t=document.body.classList.contains("lg:is-home")&&window.innerWidth>=1024?c:d,n=window.innerHeight*(t/100)-88;e>=n?L.classList.add("navbar-hidden"):L.classList.remove("navbar-hidden")}),n.length>0&&requestAnimationFrame(()=>{n.forEach(e=>e())})}window.addEventListener("scroll",()=>{g&&cancelAnimationFrame(g),g=requestAnimationFrame(E)},{passive:!0}),window.onresize=()=>{let e=Math.floor(window.innerHeight*(a/100));e-=e%4,document.documentElement.style.setProperty("--banner-height-extend",`${e}px`)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{w(),h()}):(w(),h());const v=()=>window.location.pathname.includes("/posts/")||window.location.pathname.includes("/post/");function I(){const e=document.getElementById("main-grid");if(!e)return;const t=v(),n=e.getAttribute("data-sidebar-position")||"left",o="true"===e.getAttribute("data-show-right-sidebar-on-post"),i="both"===n||t&&"left"===n&&o?"grid-cols-1 md:grid-cols-[17.5rem_1fr] xl:grid-cols-[17.5rem_1fr_17.5rem]":"grid-cols-1 md:grid-cols-[17.5rem_1fr]";["grid-cols-1","md:grid-cols-[17.5rem_1fr]","xl:grid-cols-[17.5rem_1fr_17.5rem]"].forEach(t=>e.classList.remove(t)),i.split(" ").forEach(t=>t&&e.classList.add(t))}function S(){const e=v();document.querySelectorAll(".widget-hide-on-post").forEach(t=>{e?t.classList.add("hidden"):t.classList.remove("hidden")}),document.querySelectorAll(".widget-hide-on-non-post").forEach(t=>{e?t.classList.remove("hidden"):t.classList.add("hidden")})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{I(),S(),o(),i(),l()}):(I(),S(),o(),i(),l());
